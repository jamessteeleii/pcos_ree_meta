# geom_point(
#   data = main_arm_data_effects |>
#     filter(!is.na(yi_mean)) |>
#     mutate(study_label = paste(authors, year)),
#   aes(x = yi_mean, y = study_label, color = cond),
#   position = position_dodge(width = 0.4),
#   shape = "|"
# ) +
stat_halfeye(slab_alpha = .5, point_size = 0.1, linewidth = 0.1,
position = position_dodge(width = 0.5), .width = 0.95) +
scale_fill_manual(values = c("#56B4E9", "#E69F00", "#009E73")) +
scale_color_manual(values = c("#56B4E9", "#E69F00", "#009E73")) +
geom_text(
data = mutate_if(study_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{cond}: {round(draw)} [{round(.lower)}, {round(.upper)}]"),
x = 2250, y =reorder(study_label, draw), group = cond
),
size = 2, position = position_dodge(width = 0.75),
hjust = "inward"
) +
scale_x_continuous(limits = c(0,500)) +
labs(
x = "Resting Energy Expenditure (kcal)",
title = "Conditional Estimates for Condition by Study"
) +
guides(
fill = "none",
color = "none"
) +
theme_bw() +
theme(axis.title.y = element_blank()) +
theme(title = element_text(size=8))
contrast_plot <- ggplot(meta_slopes, aes(x = draw)) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(draw)} [{round(.lower)}, {round(.upper)}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (difference in kcal)",
title = "Contrasts Between Conditions (Control - PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
(study_pred_plot | (meta_pred_plot / contrast_plot)) +
plot_annotation(title = "Standard Deviation of Resting Energy Expenditure",
caption = "Point estimates and 95% quantile intervals reported") +
plot_layout(guides = "collect", axis_titles = "collect",
# widths = c(2,1,1)
)  &
theme(axis.title.x = element_text(size=10),
legend.position = "bottom")
pp_check(arm_variance_model)
# Pooled contrast
meta_slopes <- avg_comparisons(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE)
),
re_formula = NA,
variables = "cond"
) |>
get_draws()
meta_slopes |>
group_by(contrast) |>
mean_qi(draw)
exp(0.0249)
# Pooled contrast
meta_slopes <- avg_comparisons(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE)
),
re_formula = NA,
variables = "cond"
) |>
get_draws() |>
mutate(draw = exp(draw))
meta_slopes |>
group_by(contrast) |>
mean_qi(draw)
# Pooled contrast
meta_slopes <- avg_comparisons(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE)
),
re_formula = NA,
variables = "cond"
) |>
get_draws()
contrast_labels <- meta_slopes |>
group_by(contrast) |>
mean_qi(draw)
contrast_plot <- ggplot(meta_slopes, aes(x = exp(draw))) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(exp(draw))} [{round(exp(.lower))}, {round(exp(.upper))}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (difference in kcal)",
title = "Contrasts Between Conditions (Control - PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
contrast_labels <- meta_slopes |>
group_by(contrast) |>
mean_qi(draw)
contrast_plot <- ggplot(meta_slopes, aes(x = exp(draw))) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(exp(draw))} [{round(exp(.lower))}, {round(exp(.upper))}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (difference in kcal)",
title = "Contrasts Between Conditions (Control - PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
contrast_plot
contrast_plot <- ggplot(meta_slopes, aes(x = exp(draw))) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(exp(draw))} [{round(exp(.lower))}, {round(exp(.upper))}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
# scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (difference in kcal)",
title = "Contrasts Between Conditions (Control - PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
ggplot(meta_slopes, aes(x = exp(draw))) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(exp(draw))} [{round(exp(.lower))}, {round(exp(.upper))}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
# scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (difference in kcal)",
title = "Contrasts Between Conditions (Control - PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
targets::tar_load(main_arm_variance_effects_model)
# pooled preds per condition
meta_pred <- avg_predictions(
arm_variance_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond)
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
# study level preds per condition
study_pred <- predictions(
arm_variance_model,
re_formula = NULL,
) |>
get_draws() |>
mutate(draw = exp(draw))
# Pooled contrast
meta_slopes <- avg_comparisons(
arm_variance_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE)
),
re_formula = NA,
variables = "cond"
) |>
get_draws() |>
mutate(draw = exp(draw))
# Meta pred plot
meta_labels <- meta_pred |>
group_by(cond) |>
mean_qi(draw)
ggplot(meta_pred, aes(x = draw, fill = cond)) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95) +
facet_grid(cond~.) +
scale_fill_manual(values = c("#56B4E9", "#E69F00", "#009E73")) +
geom_text(
data = mutate_if(meta_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(draw)} [{round(.lower)}, {round(.upper)}]"),
x = draw, y = 0.1
),
size = 3
) +
# scale_x_continuous(limits = c(0,500)) +
labs(
x = "Resting Energy Expenditure (kcal)",
fill = "Condition",
title = "Global Grand Mean Estimates for Condition"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
study_pred <- study_pred |>
mutate(
study_label = paste(authors, year)
) |>
group_by(study) |>
mutate(mean_draw = mean(draw)) |>
ungroup()
study_labels <- study_pred |>
group_by(study_label, cond) |>
mean_qi(draw)
ggplot(study_pred, aes(x = draw,
y = reorder(study_label, mean_draw),
fill = cond)) +
# # Add individual study data
# geom_point(
#   data = main_arm_data_effects |>
#     filter(!is.na(yi_mean)) |>
#     mutate(study_label = paste(authors, year)),
#   aes(x = yi_mean, y = study_label, color = cond),
#   position = position_dodge(width = 0.4),
#   shape = "|"
# ) +
stat_halfeye(slab_alpha = .5, point_size = 0.1, linewidth = 0.1,
position = position_dodge(width = 0.5), .width = 0.95) +
scale_fill_manual(values = c("#56B4E9", "#E69F00", "#009E73")) +
scale_color_manual(values = c("#56B4E9", "#E69F00", "#009E73")) +
geom_text(
data = mutate_if(study_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{cond}: {round(draw)} [{round(.lower)}, {round(.upper)}]"),
x = 2250, y =reorder(study_label, draw), group = cond
),
size = 2, position = position_dodge(width = 0.75),
hjust = "inward"
) +
# scale_x_continuous(limits = c(0,500)) +
labs(
x = "Resting Energy Expenditure (kcal)",
title = "Conditional Estimates for Condition by Study"
) +
guides(
fill = "none",
color = "none"
) +
theme_bw() +
theme(axis.title.y = element_blank()) +
theme(title = element_text(size=8))
contrast_labels <- meta_slopes |>
group_by(contrast) |>
mean_qi(draw)
ggplot(meta_slopes, aes(x = draw)) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(draw)} [{round(.lower)}, {round(.upper)}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (difference in kcal)",
title = "Contrasts Between Conditions (Control - PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
ggplot(meta_slopes, aes(x = draw)) +
geom_vline(xintercept = 0, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(draw,2)} [{round(.lower,2)}, {round(.upper,2)}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (ratio in kcal)",
title = "Contrasts Between Conditions (Control:PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
ggplot(meta_slopes, aes(x = draw)) +
geom_vline(xintercept = 1, lty = "dashed", size = 0.25, alpha = 0.75) +
stat_halfeye(slab_alpha = .5, point_size = 0.5, linewidth = 0.5, .width = 0.95, fill = "black") +
geom_text(
data = mutate_if(contrast_labels,
is.numeric, round, 2),
aes(
label = glue::glue("{round(draw,2)} [{round(.lower,2)}, {round(.upper,2)}]"),
x = draw, y = 0.1
),
size = 3
) +
scale_x_continuous(labels = ~sub("-", "\u2212", .x)) +
scale_x_continuous(limits = c(0,5)) +
labs(
x = "Resting Energy Expenditure Contrast (ratio in kcal)",
title = "Contrasts Between Conditions (Control:PCOS)"
) +
theme_bw() +
theme(axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.ticks.y = element_blank()) +
theme(title = element_text(size=8))
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond)
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
View(meta_pred)
pp_check(main_arm_variance_effects_model)
main_arm_variance_effects_model
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond),
vi_mean = 0
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond),
vi_mean = NA
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond),
vi_mean = 100
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond),
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond)
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
pp_check(arm_variance_model)
exp(7)
exp(7.5)
log(13000)
targets::tar_make()
targets::tar_load(main_arm_variance_effects_model)
}
fit_arm_variance_effects_model <- function(data, prior) {
arm_model <- brm(yi_sd | se(sqrt(vi_sd)) ~ 0 + Intercept + cond + me(log(yi_mean), log(sqrt(vi_mean))) + (1 + cond | lab) + (1 + cond | study) + (1 | arm),
data = data,
prior = prior,
chains = 4,
cores = 4,
seed = 1988,
warmup = 2000,
iter = 8000)
}
main_arm_variance_effects_model
# pooled preds per condition
meta_pred <- avg_predictions(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE),
cond = unique(main_arm_data_effects$cond)
),
by = "cond",
re_formula = NA
) |>
get_draws() |>
mutate(draw = exp(draw))
# study level preds per condition
study_pred <- predictions(
main_arm_variance_effects_model,
re_formula = NULL,
) |>
get_draws() |>
mutate(draw = exp(draw))
# Pooled contrast
meta_slopes <- avg_comparisons(
main_arm_variance_effects_model,
newdata = datagrid(
yi_mean = median(main_arm_data_effects$yi_mean, na.rm=TRUE)
),
re_formula = NA,
variables = "cond"
) |>
get_draws() |>
mutate(draw = exp(draw))
# Meta pred plot
meta_labels <- meta_pred |>
group_by(cond) |>
mean_qi(draw)
